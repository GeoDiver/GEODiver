var GD;GD||(GD={}),function(){GD.loadGeoDbValidation=function(){"use strict";$("#load_geo_db").validate({rules:{geo_db:{geoDb:!0,required:!0}},submitHandler:function(e){GD.loadGeoDbAjax()}})},GD.analyseValidation=function(){"use strict";$("#analyse").validate({rules:{},submitHandler:function(e){GD.GeoAnalysisAjax()}})},GD.loadGeoDbAjax=function(){"use strict";var e=$("input[name=geo_db]").val();$("#model_header_text").text("Loading GEO Dataset: "+e),$("#model_text").text("This should take a few seconds. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1}),$.ajax({type:"POST",url:"/load_geo_db",data:$("#load_geo_db").serialize(),success:function(e){$(".load_geo_db_btn").removeClass("btn-large"),$("#geo_db_summary").html(e),$("#geo_db_summary").show(),$(".adv_param_collapsible").collapsible(),$("input:radio[name=factor]:first").attr("checked",!0),$("#"+$("input:radio[name=factor]:first").attr("id")+"_select").show(),GD.addFactorToggle(),$("select").material_select(),GD.addDataSetInfo(),GD.analyseValidation(),$("#loading_modal").closeModal()},error:function(e,a){GD.ajaxError()}})},GD.GeoAnalysisAjax=function(){"use strict";var e=$("input[name=geo_db]").val();$("#model_header_text").text("Analysing GEO Dataset: "+e),$("#model_text").text("This should take a few minutes. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1}),$.ajax({type:"POST",url:"/analyse",data:$("#analyse").serialize(),success:function(e){$("#results_section").html(e),$("#results_section").show(),$("#results_tabs").tabs(),GD.createPlots(),$(".materialboxed").materialbox(),$("#loading_modal").closeModal()},error:function(e,a){GD.ajaxError()}})},GD.ajaxError=function(){var a;500==e.status||400==e.status?(a=e.responseText,$("#results_section").show(),$("#results_section").html(a),$("#loading_modal").closeModal()):(a=e.responseText,$("#results_section").show(),$("#results_section").html("There seems to be an unidentified Error."),$("#loading_modal").closeModal())},GD.setUpValidatorDefaults=function(){$.validator.addMethod("geoDb",function(e){return/^GDS\d\d\d\d?$/.test(e)},"Please enter a valid GEO dataset accession number (in the format GDSxxxx)."),$.validator.setDefaults({errorClass:"invalid",validClass:"valid",errorPlacement:function(e,a){$(a).closest("form").find("label[for='"+a.attr("id")+"']").attr("data-error",e.text())}})},GD.createPlots=function(){jsonFile=$("#DGEA").data("results-json"),$.getJSON(jsonFile,function(e){GD.createPCAPLOT(e.pc.cumVar,e.pc.expVar,e.pc.pcnames),GD.createVolcanoPlot(e.vol.logFC,e.vol.pVal)})},GD.createPCAPLOT=function(e,a,t){var o={x:t,y:e,type:"scatter",name:"Cumulative PCA"},s={x:t,y:a,type:"scatter",name:"PCA"},l=[o,s],n={legend:{x:0,y:100,traceorder:"normal"}};Plotly.newPlot("PCA_plot",l,n)},GD.createVolcanoPlot=function(e,a){var t={x:e,y:a,mode:"markers",type:"scatter",name:"volcano_plot",text:["DDR1","RFC2","HSPA6","PAX8","GUCA1A","UBA7","THRA","PTPN21","CCL5","CYP2E1","EPHB3","ESRRA","CYP2A6","SCARB1","TTLL12","LINC00152","WFDC2","MAPK1","MAPK1","ADAM32","SPATA17","PRR22","PRR22","PXK","PXK","VPS18","MSANTD3","SLC46A1","SLC46A1","TIMD4","SLC39A5","ZDHHC11","ATP6V1E2","AFG3L1P","CILP2","CILP2","PIGX","TMEM196","SLC39A13","BEST4","AK9","CORO6","TMEM106A","TMEM106A","ALG10","ALG10","TTC39C","NEXN","C15orf40","RAX2","MFAP3","EYA3","GIMAP1","GIMAP1","GIMAP1","KLK8","CCDC65","CCDC65","FAM122C","FAM122C","CFAP53","CFAP53","ARMCX4","RBBP6","CENPBD1","TRIOBP","TRIOBP","CATSPER1","HOXD4","GSC","SP7","PDE7A","CNOT7","CRYZL1","PRSS33","PRSS33","C19orf26","C19orf26","MCMDC2","TIRAP","LEAP2","MSI2","SCIN","SCIN","CTCFL","C4orf33","C4orf33","C4orf33","ZNF333","TVP23C","RDH10","RDH10","SRSF12","FAM71A","FAM71A","GAPT","FLJ30901","ERICH5","ERICH5","CCDC185"],marker:{size:7.5}},o=[t],s={xaxis:{range:[-1.15,1.15]},yaxis:{range:[5,28]},hovermode:"closest",xaxis:{title:"Log 2 Fold Change"},yaxis:{title:"-Log10(P Value)"}};Plotly.newPlot("volcano_plot",o,s)},GD.addFactorToggle=function(){$("input:radio[name=factor]").click(function(){var e="#"+$(this).attr("id")+"_select";"#"+$(".select_factors:visible").attr("id")!==e&&($(".select_factors").hide(),$(e).show())})},GD.addDataSetInfo=function(){var e=$("input[name=geo_db]").val(),a="GeoDiver/DBs/"+e+".json";$.getJSON(a,function(e){$("#dataset_accession").text(e.Accession),$("#dataset_title").text(e.Title),$("#dataset_summary").text(e.Description),$("#dataset_organism").text(e.Sample_Organism),$("#dataset_summary").text(e.Description),$("#dataset_citation").text(e.Reference)})},GD.addUserDropDown=function(){$(".dropdown-button").dropdown({inDuration:300,outDuration:225,hover:!0,belowOrigin:!0,alignment:"right"})}}(),function(e){e(function(){e(".button-collapse").sideNav(),e(".parallax").parallax(),e("select").material_select(),GD.setUpValidatorDefaults(),GD.loadGeoDbValidation(),GD.addUserDropDown()})}(jQuery);