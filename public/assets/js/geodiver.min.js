var GD;GD||(GD={}),function(){GD.setUpValidatorDefaults=function(){$.validator.addMethod("geoDb",function(e){return/^GDS\d\d\d\d?$/.test(e)},"Please enter a valid GEO dataset accession number (in the format GDSxxxx)."),$.validator.setDefaults({errorClass:"invalid",validClass:"valid",errorPlacement:function(e,t){$(t).closest("form").find("label[for='"+t.attr("id")+"']").attr("data-error",e.text())}})},GD.loadGeoDbValidation=function(){"use strict";$("#load_geo_db").validate({rules:{geo_db:{geoDb:!0,required:!0}},submitHandler:function(e){var t=$("input[name=geo_db]").val();$("#model_header_text").text("Loading GEO Dataset: "+t),$("#model_text").text("This should take a few seconds. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1}),$.ajax({type:"POST",url:"/load_geo_db",data:$("#load_geo_db").serialize(),success:function(e){$(".card-action").remove(),$("#results_section").empty(),$(e).insertAfter("#load_geo_card"),$("#geo_db_summary").html(e),$("#geo_db_summary").show(),$(".adv_param_collapsible").collapsible(),$("input:radio[name=factor]:first").attr("checked",!0),$("#"+$("input:radio[name=factor]:first").attr("id")+"_select").show(),GD.addFactorToggle(),$("select").material_select(),GD.addDataSetInfo(),GD.analyseValidation(),$("#loading_modal").closeModal()},error:function(e,t){GD.ajaxError(e,t)}})}})},GD.analyseValidation=function(){"use strict";$("#analyse").validate({rules:{},submitHandler:function(e){var t=$("input[name=geo_db]").val();$("#model_header_text").text("Analysing GEO Dataset: "+t),$("#model_text").text("This should take a few minutes. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1}),$.ajax({type:"POST",url:"/analyse",data:$("#analyse").serialize(),success:function(e){$("#results_section").html(e),$("#results_section").show(),$("#results_tabs").tabs(),GD.createPlots(),$(".materialboxed").materialbox(),$("#loading_modal").closeModal()},error:function(e,t){GD.ajaxError(e,t)}})}})},GD.geneExpressionAjax=function(e,t){$("#model_header_text").text("Loading Graphics for Gene: "+t),$("#model_text").text("This should take a few seconds. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1});var a=e.closest(".results_card").data("results_id"),o=e.closest(".results_card").data("geo_db");console.log(o),console.log(a),console.log(t),console.log("dffdfd"),$.ajax({type:"POST",url:"/gene_expression_url",data:{gene_id:t,result_id:a,geo_db:o},success:function(a){e.addClass("parent"),e.after('<tr class="child" id="'+t+'ChildRow"><td colspan="8"><div id="'+t+'Plot"></div></td></tr>'),GD.createExpressionPlot(a,t),$("#loading_modal").closeModal()},error:function(e,t){GD.ajaxError(e,t)}})},GD.interactionNetworkAjax=function(e,t){$("#model_header_text").text("Loading Graphics for GeneSet: "+t),$("#model_text").text("This should take a few seconds. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1});var a=e.closest(".results_card").data("results_id"),o=e.closest(".results_card").data("geo_db");console.log(o),console.log(a),console.log(t),$.ajax({type:"POST",url:"/interaction",data:{path_id:t,result_id:a,geo_db:o},success:function(a){console.log(a),e.addClass("parent"),e.after('<tr class="child" id="'+t+'ChildRow"><td colspan="8"><div id="'+t+'Plot"><p>hey</p></div></td></tr>'),$("#loading_modal").closeModal()},error:function(e,t){GD.ajaxError(e,t)}})},GD.ajaxError=function(e,t){var a;500==e.status||400==e.status?(a=e.responseText,$("#results_section").show(),$("#results_section").html(a),$("#loading_modal").closeModal()):(a=e.responseText,$("#results_section").show(),$("#results_section").html("There seems to be an unidentified Error."),$("#loading_modal").closeModal())},GD.loadPcRedrawValidation=function(){$("#pca_redraw").validate({rules:{},submitHandler:function(e,t){t.preventDefault(),$("#principle_plot").empty();var a=$("select[name=PCoption1]").val(),o=$("select[name=PCoption2]").val(),l=$("#overview").data("overview-json");$.getJSON(l,function(e){GD.createPCAScatterPlot(e.pcdata,a,o)})}})},GD.createPlots=function(){var e=$("#overview").data("overview-json");$.getJSON(e,function(e){pcaPlot=GD.createPCAPLOT(e.pc.cumVar,e.pc.expVar,e.pc.pcnames),pcaScatterPlot=GD.createPCAScatterPlot(e.pcdata,"PC1","PC2"),GD.initialiatizePcaScatterPlot(e.pc.pcnames),$("select").material_select()});var t=$("#DGEA").data("dgea-json");$.getJSON(t,function(e){volcanoPlot=GD.createVolcanoPlot(e.vol.logFC,e.vol.pVal,e.vol.genes),GD.initializeToptable(e.tops,"dgea-top-table","dgea-top-table-wrapper")});var a=$("#GSEA").data("gsea-json");$.getJSON(a,function(e){GD.initializeToptable(e.tops,"gsea-top-table","gsea-top-table-wrapper")}),window.onresize=function(){Plotly.Plots.resize(pcaPlot),Plotly.Plots.resize(volcanoPlot),Plotly.Plots.resize(pcaScatterPlot)}},GD.createPCAScatterPlot=function(e,t,a){var o={x:e[t+".Group1"],y:e[a+".Group1"],type:"scatter",mode:"markers",name:"Group1"},l={x:e[t+".Group2"],y:e[a+".Group2"],type:"scatter",mode:"markers",name:"Group2"},n=[o,l],i={xaxis:{title:t},yaxis:{title:a}},s=100,r=Plotly.d3.select("#principle_plot").style({width:s+"%","margin-left":(100-s)/2+"%"}),d=r.node();return Plotly.newPlot(d,n,i),d},GD.createPCAPLOT=function(e,t,a){var o={x:a,y:e,type:"scatter",name:"Cumulative PCA"},l={x:a,y:t,type:"scatter",name:"PCA"},n=[o,l],i={legend:{x:0,y:100,traceorder:"normal"}},s=100,r=Plotly.d3.select("#PCA_plot").style({width:s+"%","margin-left":(100-s)/2+"%"}),d=r.node();return Plotly.newPlot(d,n,i),d},GD.createVolcanoPlot=function(e,t,a){var o={x:e,y:t,text:a,mode:"markers",type:"scatter",name:"volcano_plot",marker:{size:7.5}},l=[o],n={xaxis:{title:"Log 2 Fold Change"},yaxis:{title:"-Log10(P Value)"},hovermode:"closest"},i=100,s=Plotly.d3.select("#volcano_plot").style({width:i+"%","margin-left":(100-i)/2+"%"}),r=s.node();return Plotly.newPlot(r,l,n),r},GD.createExpressionPlot=function(e,t){var a={x:e.group1.x,y:e.group1.y,type:"bar",name:"Group 1"},o={x:e.group2.x,y:e.group2.y,type:"bar",name:"Group 2"},l=[a,o],n={barmode:"group",xaxis:{title:"Sample",tickangle:-40,position:-.5},yaxis:{title:"Expression"}},i=100,s=Plotly.d3.select("#"+t+"Plot").style({width:i+"%","margin-left":(100-i)/2+"%"}),r=s.node();Plotly.newPlot(r,l,n),window.onresize=function(){Plotly.Plots.resize(r)}},GD.initializeToptable=function(e,t,a){e=GD.addPlotIconToTopTable(e);$("#"+t).dataTable({oLanguage:{sStripClasses:"",sSearch:"",sSearchPlaceholder:"Enter Keywords Here",sInfo:"_START_ -_END_ of _TOTAL_",sLengthMenu:'<span>Rows per page:</span><select class="browser-default"><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">All</option></select></div>'},data:e,order:[[5,"asc"]],bAutoWidth:!1});GD.makePlotIconClickable(a),$("#"+a).on("click",".search-toggle",function(){"none"==$(".hiddensearch").css("display")?$(".hiddensearch").slideDown():$(".hiddensearch").slideUp()}),$("#"+a).on("click",".download-top-table",function(){return $("#model_header_text").text("Creating Download Link"),$("#model_text").text("This should take a few seconds. Please leave this page open"),$("#loading_modal").openModal({dismissible:!1}),$.fileDownload($(this).attr("href"),{successCallback:function(e){$("#loading_modal").closeModal()},failCallback:function(e,t){$("#loading_modal").closeModal()}}),!1})},GD.addPlotIconToTopTable=function(e){return $.each(e,function(e,t){t.push('<i class="material-icons child-row-chart light-blue-text text-darken-3">insert_chart</i>')}),e},GD.makePlotIconClickable=function(e){$("#"+e).on("click",".child-row-chart",function(){var t=$(this).closest("tr"),a=t.children("td:first").text();$("#"+a+"ChildRow").length?$("#"+a+"ChildRow").remove():"dgea-top-table-wrapper"===e?GD.geneExpressionAjax(t,a):"gsea-top-table-wrapper"===e&&GD.interactionNetworkAjax(t,a)})},GD.initialiatizePcaScatterPlot=function(e){$.each(e,function(e,t){$("#PCoption1").append($("<option></option>").attr("value",t).text(t)),$("#PCoption2").append($("<option></option>").attr("value",t).text(t))}),GD.loadPcRedrawValidation()},GD.addFactorToggle=function(){$("input:radio[name=factor]").click(function(){var e="#"+$(this).attr("id")+"_select";"#"+$(".select_factors:visible").attr("id")!==e&&($(".select_factors").hide(),$(e).show())})},GD.addDataSetInfo=function(){var e=$("input[name=geo_db]").val(),t="GeoDiver/DBs/"+e+".json";$.getJSON(t,function(e){$("#dataset_accession").text(e.Accession),$("#dataset_title").text(e.Title),$("#dataset_summary").text(e.Description),$("#dataset_organism").text(e.Sample_Organism),$("#dataset_summary").text(e.Description),$("#dataset_citation").text(e.Reference)})},GD.addUserDropDown=function(){$(".dropdown-button").dropdown({inDuration:300,outDuration:225,hover:!0,belowOrigin:!0,alignment:"right"})}}(),function(e){e(function(){e(".button-collapse").sideNav(),e(".parallax").parallax(),e("select").material_select(),GD.setUpValidatorDefaults(),GD.loadGeoDbValidation(),GD.addUserDropDown()})}(jQuery);